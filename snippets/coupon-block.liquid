{%- comment -%}
Minimal, scoped coupon
Shows: COUPON: BF20 (COPY)
Subtext: Black Friday ðŸŽ‰ use the coupon above at checkout for 20% off
{%- endcomment -%}

{%- assign code = code | default: 'BF20' -%}
{%- assign text = text | default: 'Black Friday ðŸŽ‰ use the coupon above at checkout for 20% off' -%}
{%- assign color = color | default: '#e60013' -%}
{%- assign uid = uid | default: 'coupon' -%}
{%- assign mt = margin_top | default: 12 -%}
{%- assign mb = margin_bottom | default: 0 -%}

<div id="coupon-{{ uid }}" class="coupon" style="--c: {{ color }}; margin: {{ mt }}px 0 {{ mb }}px;">
  <div class="coupon-line">
    <span class="coupon-label">COUPON:</span>
    <strong class="coupon-code">{{ code }}</strong>
    <button class="coupon-copy" type="button" data-copy="{{ code }}">COPY</button>
  </div>
  <p class="coupon-text">{{ text }}</p>
</div>

<style>
  /* scope everything to this instance */
  #coupon-{{ uid }} { background: transparent; }

  #coupon-{{ uid }} .coupon-line{
    display:flex; align-items:center; gap:.75rem; flex-wrap:nowrap;
    padding:.6rem .8rem;
    border:1.5px dotted var(--c);
    border-radius:12px;
  }

  #coupon-{{ uid }} .coupon-label{
    font-size:.85rem; letter-spacing:.08em; color:#fff; opacity:.9;
  }

  #coupon-{{ uid }} .coupon-code{
    font-family: var(--font-heading--family, inherit);
    font-weight:700; letter-spacing:.06em; color:#fff;
    font-size: clamp(1rem, 2.2vw, 1.125rem);
  }

  #coupon-{{ uid }} .coupon-copy{
    margin-left:auto;
    height:32px; padding:0 .85rem;
    border-radius:999px;
    border:1.5px dotted var(--c);
    background:transparent; color:#fff;
    font-size:.8rem; line-height:1; cursor:pointer;
  }
  #coupon-{{ uid }} .coupon-copy:focus{ outline:2px solid rgba(255,255,255,.25); outline-offset:2px; }
  #coupon-{{ uid }} .coupon-copy:active{ transform: translateY(1px); }

  #coupon-{{ uid }} .coupon-text{
    margin:.55rem 0 0; font-size:.95rem; color:#c9c9cc;
  }

  @media (max-width:640px){
    #coupon-{{ uid }} .coupon-line{ padding:.55rem .7rem; }
    #coupon-{{ uid }} .coupon-copy{ height:30px; padding:0 .75rem; }
  }
</style>

<script>
  document.addEventListener('click', function(e){
    const root = document.getElementById('coupon-{{ uid }}');
    if(!root) return;
    const btn = e.target.closest('#coupon-{{ uid }} .coupon-copy');
    if(!btn) return;
    const code = btn.getAttribute('data-copy') || '';
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(code).then(function(){
        const old = btn.textContent;
        btn.textContent = 'COPIED';
        setTimeout(function(){ btn.textContent = old; }, 900);
      });
    }
  });
</script>
