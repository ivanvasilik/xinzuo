{%- comment -%}
Coupon UI with consistent dashed/dotted/solid border and optional panel.
Controls you can pass in the render:
  code: 'BF20'
  text: 'Black Friday ðŸŽ‰ use the coupon above at checkout for 20% off'
  color: '#e60013'          # border + button color
  uid: block.id             # unique scope id
  margin_top: 12
  margin_bottom: 0

  border_style: 'dashed' | 'dotted' | 'solid'
  stroke_width: 2           # border thickness (and dot size for dotted)
  dash_len: 12              # dashed only
  dash_gap: 8               # dashed only
  dot_gap: 10               # dotted only
  radius: 10                # corner radius of the row
  panel: true               # adds a subtle panel background to feel like a section
  panel_bg: '#1f1f24'
{%- endcomment -%}

{%- assign code = code | default: 'BF20' -%}
{%- assign text = text | default: 'Black Friday ðŸŽ‰ use the coupon above at checkout for 20% off' -%}
{%- assign color = color | default: '#e60013' -%}
{%- assign uid = uid | default: 'coupon' -%}
{%- assign mt = margin_top | default: 12 -%}
{%- assign mb = margin_bottom | default: 0 -%}

{%- assign border_style = border_style | default: 'dashed' -%}
{%- assign stroke_width = stroke_width | default: 2 -%}
{%- assign dash_len = dash_len | default: 12 -%}
{%- assign dash_gap = dash_gap | default: 8 -%}
{%- assign dot_gap = dot_gap | default: 10 -%}
{%- assign radius = radius | default: 10 -%}
{%- assign panel = panel | default: true -%}
{%- assign panel_bg = panel_bg | default: '#1f1f24' -%}

<div id="coupon-{{ uid }}" class="coupon-ui" style="--c: {{ color }}; --radius: {{ radius }}px; margin: {{ mt }}px 0 {{ mb }}px;">
  <div class="coupon-panel{% unless panel %} no-panel{% endunless %}" style="{% if panel %}--panel-bg: {{ panel_bg }};{% endif %}">
    <div class="coupon-row" role="button" tabindex="0" aria-label="Copy coupon {{ code }}" data-copy="{{ code }}">
      {%- if border_style != 'solid' -%}
      <!-- Four independent sides so dash/dot spacing stays uniform -->
      <svg class="coupon-frame" viewBox="0 0 100 40" preserveAspectRatio="none" aria-hidden="true">
        {%- if border_style == 'dashed' -%}
          {%- assign cap = 'butt' -%}
          {%- assign dash = dash_len | append: ' ' | append: dash_gap -%}
        {%- elsif border_style == 'dotted' -%}
          {%- assign cap = 'round' -%}
          {%- assign dash = stroke_width | append: ' ' | append: dot_gap -%}
        {%- else -%}
          {%- assign cap = 'butt' -%}
          {%- assign dash = '' -%}
        {%- endif -%}

        <!-- top -->
        <line x1="{{ radius }}" y1="1" x2="{{ 100 | minus: radius }}" y2="1"
              stroke="var(--c)" stroke-width="{{ stroke_width }}"
              stroke-linecap="{{ cap }}" {% if dash != '' %}stroke-dasharray="{{ dash }}"{% endif %} />
        <!-- bottom -->
        <line x1="{{ radius }}" y1="39" x2="{{ 100 | minus: radius }}" y2="39"
              stroke="var(--c)" stroke-width="{{ stroke_width }}"
              stroke-linecap="{{ cap }}" {% if dash != '' %}stroke-dasharray="{{ dash }}"{% endif %} />
        <!-- left -->
        <line x1="1" y1="{{ radius }}" x2="1" y2="{{ 40 | minus: radius }}"
              stroke="var(--c)" stroke-width="{{ stroke_width }}"
              stroke-linecap="{{ cap }}" {% if dash != '' %}stroke-dasharray="{{ dash }}"{% endif %} />
        <!-- right -->
        <line x1="99" y1="{{ radius }}" x2="99" y2="{{ 40 | minus: radius }}"
              stroke="var(--c)" stroke-width="{{ stroke_width }}"
              stroke-linecap="{{ cap }}" {% if dash != '' %}stroke-dasharray="{{ dash }}"{% endif %} />
      </svg>
      {%- endif -%}

      <span class="coupon-label">COUPON:</span>
      <strong class="coupon-code">{{ code }}</strong>
      <button class="coupon-copy" type="button" data-copy="{{ code }}">COPY</button>
    </div>
  </div>
  <p class="coupon-text">{{ text }}</p>
</div>

<style>
  /* Scope */
  #coupon-{{ uid }}{ background: transparent; }

  /* Optional panel wrapper to feel like its own section */
  #coupon-{{ uid }} .coupon-panel{
    padding: 12px;
    border-radius: calc(var(--radius) + 6px);
    background: var(--panel-bg, transparent);
    box-shadow: 0 0 0 1px rgba(230,0,19,.12) inset;
  }
  #coupon-{{ uid }} .coupon-panel.no-panel{ padding:0; background:transparent; box-shadow:none; }

  /* Row surface */
  #coupon-{{ uid }} .coupon-row{
    position: relative;
    display:flex; align-items:center; gap:.75rem; flex-wrap:nowrap;
    padding:.7rem .95rem;
    border-radius: var(--radius);
    background: transparent;
    cursor: pointer;
    {% if border_style == 'solid' %} border: {{ stroke_width }}px solid var(--c); {% else %} border: none; {% endif %}
  }
  #coupon-{{ uid }} .coupon-frame{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; }

  /* Text */
  #coupon-{{ uid }} .coupon-label{
    font-size:.82rem; letter-spacing:.08em; text-transform:uppercase; color:#fff; opacity:.9; white-space:nowrap; flex:0 0 auto;
  }
  #coupon-{{ uid }} .coupon-code{
    font-family: var(--font-heading--family, inherit);
    font-weight:700; letter-spacing:.06em; color:#fff;
    font-size: clamp(1rem, 2.2vw, 1.125rem);
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex:1 1 auto; min-width:0;
  }

  /* Compact filled COPY chip */
  #coupon-{{ uid }} .coupon-copy{
    display:inline-flex; align-items:center; justify-content:center; box-sizing:border-box;
    flex:0 0 auto; height:30px; padding:0 .75rem;
    border-radius:10px; border:1px solid var(--c); background: var(--c);
    color:#fff; font-size:.8rem; font-weight:700; letter-spacing:.04em; line-height:1; cursor:pointer;
  }
  #coupon-{{ uid }} .coupon-copy:hover{ filter:brightness(1.05); }
  #coupon-{{ uid }} .coupon-copy:focus{ outline:2px solid rgba(255,255,255,.25); outline-offset:2px; }
  #coupon-{{ uid }} .coupon-copy:active{ transform: translateY(1px); }

  /* Subtext */
  #coupon-{{ uid }} .coupon-text{ margin:.6rem 0 0; font-size:.95rem; color:#c9c9cc; }

  /* Mobile */
  @media (max-width:640px){
    #coupon-{{ uid }} .coupon-panel{ padding:10px; }
    #coupon-{{ uid }} .coupon-row{ padding:.6rem .85rem; }
    #coupon-{{ uid }} .coupon-copy{ height:28px; padding:0 .65rem; }
  }
</style>

<script>
  (function(){
    var root = document.getElementById('coupon-{{ uid }}');
    if(!root) return;
    function doCopy(value, btn){
      if (!navigator.clipboard || !navigator.clipboard.writeText) return;
      navigator.clipboard.writeText(value).then(function(){
        if (btn){
          var old = btn.textContent;
          btn.textContent = 'COPIED';
          setTimeout(function(){ btn.textContent = old; }, 900);
        }
      });
    }
    root.addEventListener('click', function(e){
      var btn = e.target.closest('#coupon-{{ uid }} .coupon-copy');
      var row = e.target.closest('#coupon-{{ uid }} .coupon-row');
      if (btn){ doCopy(btn.getAttribute('data-copy') || '', btn); }
      else if (row){ doCopy(row.getAttribute('data-copy') || '', root.querySelector('.coupon-copy')); }
    });
    root.addEventListener('keydown', function(e){
      var row = e.target.closest('#coupon-{{ uid }} .coupon-row');
      if (row && (e.key === 'Enter' || e.key === ' ')){
        e.preventDefault();
        doCopy(row.getAttribute('data-copy') || '', root.querySelector('.coupon-copy'));
      }
    });
  })();
</script>
