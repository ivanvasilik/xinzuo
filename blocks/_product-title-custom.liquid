{%- liquid
  assign product = closest.product
  assign block_settings = block.settings
  
  # Always find the knife series collection
  # Look for collections with "-series" in handle (e.g., "xinzuo-supreme-series-knives")
  # This ensures we show the correct series, not "Best Sellers" or other collections
  assign series_collection = null
  for coll in product.collections
    # Check if handle contains "-series" (e.g., "xinzuo-supreme-series-knives")
    # Use "-series" to avoid matching "best-sellers" which contains "series"
    if coll.handle contains '-series'
      assign series_collection = coll
      break
    endif
  endfor
  
  # If no series found, look for collections with "Series" in title
  if series_collection == null
    for coll in product.collections
      if coll.title contains "Series"
        assign series_collection = coll
        break
      endif
    endfor
  endif
  
  # Fallback to non-generic collection if no series found
  if series_collection == null
    for coll in product.collections
      unless coll.handle contains 'all' or coll.handle == 'knives' or coll.handle contains 'best-sellers'
        assign series_collection = coll
        break
      endunless
    endfor
  endif
  
  # Final fallback
  if series_collection == null
    assign series_collection = product.collections.first
  endif
-%}

<div class="product-title-custom" {{ block.shopify_attributes }}>
  {% if block_settings.show_breadcrumbs %}
    <div class="product-details-links">
      <span>
        <a href="/">Home</a>
        <span>&gt;</span>
        {% if product.metafields.custom.isknife == true %}
          <a href="/collections/knives">KNIVES</a>
        {% else %}
          <a href="/collections/accessories">ACCESSORIES</a>
        {% endif %}
        {% comment %} Only show the series collection in breadcrumbs {% endcomment %}
        {% if series_collection and series_collection.handle contains '-series' %}
          <span>&gt;</span>
          <a href="{{ series_collection.url }}">{{ series_collection.title }}</a>
        {% endif %}
      </span>
    </div>
  {% endif %}
  
  <h2 id="product-variant-title" class="product-title">{{ product.title }}</h2>
</div>

{% stylesheet %}
  .product-title-custom {
    width: 100%;
  }

  .product-details-links {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .product-details-links > span {
    display: flex;
    gap: 6px;
  }

  .product-details-links span {
    font-family: "Sen";
    font-weight: 400;
    font-size: 14px;
    color: #c9c9cc;
  }

  .product-details-links a {
    color: #c9c9cc;
  }

  .product-title {
    font-family: "Sen";
    font-weight: 600;
    font-size: 36px;
    line-height: 135%;
    color: #fff;
    margin: 0;
  }

  @media screen and (max-width: 750px) {
    .product-title {
      font-size: 22px;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Product Title",
  "tag": null,
  "settings": [
    {
      "type": "checkbox",
      "id": "show_breadcrumbs",
      "label": "Show Breadcrumbs",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_knives_link",
      "label": "Show 'KNIVES' in Breadcrumbs",
      "default": true,
      "info": "Adds 'KNIVES' link between Home and Collection"
    }
  ]
}
{% endschema %}