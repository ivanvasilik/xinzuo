<div>
    <div class="engrave-btns">
        <button type="button" class="engrave-btn active" onclick="engrave(0)">{{ block.settings.btn1 }}</button>
        <button type="button" class="engrave-btn" onclick="engrave(1)">{{ block.settings.btn2 }}</button>
    </div>
    <div class="engrave-div">
        <input type="text" name="properties[Engraving Text]" placeholder="Enter text, e.g.: Chef" id="engravedInput" maxlength="20">
        <span class="engraving-count"></span>
    </div>
    <p>{{ block.settings.engraving_text }}</p>
</div>

{% style %}
    .engrave-btns {
        display: flex;
        gap: 8px;
    }

    .engrave-btn {
        padding: 12px 16px;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        color: #c9c9cc;
        font-family: "Sen";
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
    }

    .engrave-btn.active {
        background-color: #ff0004;
        border-color: #ff0004;
        color: #ffffff;
    }

    .engrave-div {
        display: none;
        margin-top: 12px;
        gap: 8px;
        align-items: center;
    }
{% endstyle %}

<script>
    window.engravingSelected = false;
    window.engravingText = "";
    const engrave = (num) => {
        const engraves = document.querySelectorAll(".engrave-btn");
        const engraveDiv = document.querySelector(".engrave-div");
        if (engraves.length > 0) {
            engraves.forEach(engrave => {
                engrave.classList.remove('active');
            })
            engraves[num].classList.add('active');
        }
        if (engraveDiv) {
            if (num == 0) {
                engraveDiv.style.display = "none";
                window.engravingSelected = false;
            } else {
                engraveDiv.style.display = "flex";
                window.engravingSelected = true;
            }
        }
    }

    document.querySelector('#engravedInput').addEventListener("input", e => {
        window.engravingText = e.target.value;
    });

    {% comment %} document.addEventListener("cart:update", async () => {
        const changed = await syncEngravingFeeQuantity();
        if (changed) {
            setTimeout(async () => {
            const res = await fetch("/?sections=cart-drawer,cart-icon-bubble");
            const sections = await res.json();
            document.dispatchEvent(
                new CustomEvent("cart:update", {
                    detail: { data: { sections } },
                })
            );
            }, 60);
        }
    }); {% endcomment %}
</script>

{% schema %}
{
    "name": "Engraving option",
    "tag": null,
    "settings": [
        {
            "type": "text",
            "id": "btn1",
            "label": "First Button",
            "default": "Without engraving"
        },
        {
            "type": "text",
            "id": "btn2",
            "label": "Second Button",
            "default": "Engrave text (+$15)"
        },
        {
            "type": "text",
            "id": "engraving_text",
            "label": "Engraving title",
            "default": "Letters, numbers, and basic punctuation only (. , ! ? ' -)"
        },
        {
            "type": "range",
            "id": "engraving_length",
            "label": "Engraving Length",
            "min": 10,
            "max": 40,
            "default": 20,
            "step": 1
        }
    ]
}
{% endschema %}