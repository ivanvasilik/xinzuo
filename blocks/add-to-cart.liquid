{%- doc -%}
  This block is used to display the add to cart button.
  Intended for product-form.liquid block.

  @param {string} can_add_to_cart - Whether the product can be added to the cart
  @param {string} add_to_cart_text - The text of the add to cart button
{%- enddoc -%}

{% liquid
  assign class = 'add-to-cart-button ' | append: block.settings.style_class
  assign id = 'BuyButtons-ProductSubmitButton-' | append: block.id
%}

<span
  {{ block.shopify_attributes }}
  style="--add-to-cart-font-case: {{ settings.button_text_case }};"
>
  {% render 'add-to-cart-button',
    id: id,
    class: class,
    can_add_to_cart: can_add_to_cart,
    product: closest.product,
    add_to_cart_text: add_to_cart_text
  %}
</span>

{% assign coupon_code = block.settings.coupon_code %}
{% assign coupon_text = block.settings.coupon_text %}
{% assign coupon_color = block.settings.coupon_color %}

{% if block.settings.coupon == true %}
  {% render 'coupon-block',
    uid: block.id,
    code: block.settings.coupon_code,
    text: coupon_text,
    color: coupon_color,
    border_style: 'dotted',
    stroke_width: 2,
    dot_gap: 7,
    panel: true,
    panel_bg: '#1f1f24',
    panel_padding: 8,
    radius: 1,
    panel_radius: 14
  %}
{% endif %}


{% schema %}
{
  "name": "t:names.add_to_cart",
  "tag": null,
  "settings": [
    {
      "type": "select",
      "id": "style_class",
      "label": "t:settings.style",
      "options": [
        { "value": "button", "label": "t:options.primary" },
        { "value": "button-secondary", "label": "t:options.secondary" }
      ],
      "default": "button-secondary"
    },
    {
      "type": "checkbox",
      "id": "coupon",
      "label": "Coupon",
      "default": true
    },
    {
      "type": "text",
      "id": "coupon_code",
      "label": "Coupon Code",
      "visible_if": "{{ block.settings.coupon == true }}"
    },
    {
      "type": "text",
      "id": "coupon_text",
      "label": "Coupon Text",
      "visible_if": "{{ block.settings.coupon == true }}"
    },
    {
      "type": "color",
      "id": "coupon_color",
      "label": "Coupon Color",
      "visible_if": "{{ block.settings.coupon == true }}"
    }
  ]
}
{% endschema %}
